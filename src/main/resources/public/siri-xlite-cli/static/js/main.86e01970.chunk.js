(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{56:function(t,e,n){t.exports=n(80)},67:function(t,e,n){},69:function(t,e,n){},77:function(t,e,n){},79:function(t,e,n){},80:function(t,e,n){"use strict";n.r(e);var o=n(0),a=n.n(o),r=n(18),i=n.n(r),u=n(19),s=(n(67),n(20)),c=n(21),l=n(25),p=n(22),m=n(26),f=n(14),h=n(34),d=n(5),g=(n(68),n(29)),b=n(49),v=n(50),E=n.n(v),O=n(83),S=Object(O.a)({"LINES_DISCOVERY/SUCCESS":function(t,e){return Object.assign({},t,{linesDiscovery:e.payload})},"LINES_DISCOVERY/FAILURE":function(t,e){return Object.assign({},t,{linesDiscovery:{}})},"STOP_POINTS_DISCOVERY/SUCCESS":function(t,e){return Object.assign({},t,{stopPointsDiscovery:e.payload})},"STOP_POINTS_DISCOVERY/FAILURE":function(t,e){return Object.assign({},t,{stopPointsDiscovery:{}})},"STOP_MONITORING/SUCCESS":function(t,e){var n=Object.assign({},t);return n.stopMonitoring[e.meta.name]=e.payload,n},"STOP_MONITORING/FAILURE":function(t,e){var n=Object.assign({},t);return delete n.stopMonitoring[e.meta.name],n},"ESTIMATED_TIMETABLE/SUCCESS":function(t,e){var n=Object.assign({},t);return n.estimatedTimetable[e.meta.name]=e.payload,n},"ESTIMATED_TIMETABLE/FAILURE":function(t,e){var n=Object.assign({},t);return delete n.estimatedTimetable[e.meta.name],n}},{linesDiscovery:[],stopPointsDiscovery:[],stopMonitoring:[],estimatedTimetable:[]}),y=Object(g.c)(S,Object(g.a)(b.a,E.a)),j=(n(69),n(82)),L=n(24),I=n(54),C=n(85),M=n(84),T={get:function(t){for(var e=this,n=this.toTile(t["BoundingBox.UpperLeft.Longitude"],t["BoundingBox.UpperLeft.Latitude"],15),o=this.toTile(t["BoundingBox.LowerRight.Longitude"],t["BoundingBox.LowerRight.Latitude"],15),a=[],r=n[1];r<=o[1];r++)for(var i=n[0];i<=o[0];i++){var u="";u+="/siri-xlite/stoppoints-discovery/"+i+"/"+r,a.push(u)}return Object(I.a)(a).pipe(Object(C.a)(function(t){return e.request(t)}),Object(M.a)(function(t,e){return t.concat(e)}))},toTile:function(t,e,n){return[Math.floor((t+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]},request:function(t){return Object(I.a)(fetch(t,{"Content-Type":"application/json"}).then(function(t){return t.json()}))}},P={get:function(t){var e="";return e+="/siri-lite/stop-monitoring",e+=t&&"?"+Object.entries(t).map(function(t){var e=Object(L.a)(t,2),n=e[0],o=e[1];return"".concat(n,"=").concat(o)}).join("&"),this.request(e)},request:function(t){return console.log("request "+t),Object(I.a)(fetch(t,{"Content-Type":"application/json"}).then(function(t){return t.json()}))}},D=Object(j.a)({LINES_DISCOVERY:{SUCCESS:function(t){return t},FAILURE:function(t){return t}},STOP_POINTS_DISCOVERY:{SUCCESS:function(t){return t},FAILURE:function(t){return t}},STOP_MONITORING:{SUCCESS:[function(t){return t},function(t,e){return{name:e}}],FAILURE:[function(t){return t},function(t,e){return{name:e}}]},ESTIMATED_TIMETABLE:{SUCCESS:[function(t){return t},function(t,e){return{name:e}}],FAILURE:[function(t){return t},function(t,e){return{name:e}}]}}),U=D,k=n(51),R=n.n(k),N=n(52),B=(n(77),function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(l.a)(this,Object(p.a)(e).call(this,t))).counter=1,n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"initialize",value:function(){var t,e=this,n=(t={},Object(f.a)(t,"MonitoringRef",this.props.name),Object(f.a)(t,"MaximumStopVisits",this.props.length),Object(f.a)(t,"MaximumNumberOfCalls.Previous",0),Object(f.a)(t,"MaximumNumberOfCalls.Onwards",0),t);this.props.onChange(n),this.timer=setInterval(function(t){return e.counter++&&e.props.onChange(n)},1e4)}},{key:"dispose",value:function(){clearInterval(this.timer),this.props.onClose()}},{key:"render",value:function(){var t=function(t){return a.a.createElement("tr",null,a.a.createElement("th",{scope:"row"},a.a.createElement(R.a,{format:"HH:mm"},t.value.MonitoredCall.ExpectedDepartureTime)),a.a.createElement("td",{style:{textTransform:"uppercase"}},t.value.DestinationName),a.a.createElement("td",{style:{textTransform:"uppercase"}},t.value.PublishedLineName),a.a.createElement("td",null,a.a.createElement(N.a,{style:{color:"steelblue"},icon:"bus"})))};return a.a.createElement("div",null,a.a.createElement("h5",null,"#",this.counter," StopMonitoring: ",this.props.name),a.a.createElement("table",{className:"table table-sm table-hover"},a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Departure"),a.a.createElement("th",null,"Destination"),a.a.createElement("th",null,"Line"),a.a.createElement("th",null,"#"))),a.a.createElement("tbody",null,a.a.createElement(function(e){return e.values?e.values.map(function(e){return a.a.createElement(t,{value:e.MonitoredVehicleJourney,key:e.ItemIdentifier})}):null},{values:this.props.values}))))}}]),e}(a.a.Component)),w=Object(h.a)(function(t,e){return t.stopMonitoring[e.name]},function(t){return t?t.Siri.StopMonitoringDelivery.MonitoredStopVisit:[]}),A=Object(u.b)(function(t,e){return{name:e.name,length:e.length,values:w(t,e)}},function(t){return{onClose:function(){return t(U.stopMonitoring.failure({}))},onChange:function(e){var n,o;t((n=e,o=e.MonitoringRef,function(t){return P.get(n).subscribe(function(e){return t(D.stopMonitoring.success(e,o))},function(e){return t(D.stopMonitoring.failure(e,o))})}))}}})(B),x=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(l.a)(this,Object(p.a)(e).call(this,t))).ref=a.a.createRef(),n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"componentDidUpdate",value:function(){this.update(this.props.value)}},{key:"initialize",value:function(){this.stopPointIcon=d.icon({iconUrl:"images/marker-icon.png",shadowUrl:"images/marker-shadow.png"}),this.stopAreaIcon=d.icon({iconUrl:"images/marker-red-icon.png",shadowUrl:"images/marker-shadow.png"}),this.map=new d.map(this.ref.current,{center:d.latLng(this.props.center),zoom:this.props.zoom}),d.tileLayer(this.props.url,{}).addTo(this.map),this.markers=d.layerGroup([]).addTo(this.map),this.popups=d.layerGroup([]).addTo(this.map),d.control.scale().addTo(this.map),d.control.mousePosition({position:"bottomright"}).addTo(this.map),this.map.on("moveend",this.load,this),this.load()}},{key:"dispose",value:function(){this.props.onClose()}},{key:"load",value:function(){var t=this.map.getBounds();console.log("[DSU] bounds"),console.log(t);var e=this.markers.getLayers().length;if(!this.bounds||!this.bounds.contains(t)||0===e){var n,o=this.diff(t.getEast(),t.getWest()),a=this.diff(t.getNorth(),t.getSouth());console.log("[DSU] dx: "+o),console.log("[DSU] dy: "+a),this.bounds=new d.LatLngBounds(new d.LatLng(t.getSouth()-a,t.getWest()-o),new d.LatLng(t.getNorth()+a,t.getEast()+o));var r=(n={},Object(f.a)(n,"BoundingBox.UpperLeft.Longitude",t.getNorthWest().lng),Object(f.a)(n,"BoundingBox.UpperLeft.Latitude",t.getNorthWest().lat),Object(f.a)(n,"BoundingBox.LowerRight.Longitude",t.getSouthEast().lng),Object(f.a)(n,"BoundingBox.LowerRight.Latitude",t.getSouthEast().lat),n);console.log("[DSU] call load"),console.log(r),this.props.onChange(r)}}},{key:"diff",value:function(t,e){return t*e>0?Math.abs(e-t):Math.abs(t)+Math.abs(e)}},{key:"update",value:function(t){var e=this;console.log("[DSU] update "),console.log(t),this.markers.clearLayers(),this.popups.clearLayers(),t&&t.length>0&&t.forEach(function(t){var n=d.latLng(t.location.latitude,t.location.longitude),o={title:t.stopName+"\n"+t.stopPointRef,alt:t.stopPointRef,icon:t.stopPointRef.startsWith("StopArea")?e.stopAreaIcon:e.stopPointIcon},a=d.marker(n,o);a.on("click",function(){e.createPopup(a)}),e.markers.addLayer(a)})}},{key:"createPopup",value:function(t){var e=t.getPopup();if(e)e.closePopup();else{var n=d.popup({autoClose:!1,closeOnClick:!1,closeButton:!1});n.setLatLng(t.getLatLng());var o=document.createElement("div");n.setContent(o);var r=a.a.createElement(u.a,{store:y},a.a.createElement(A,{name:t.options.alt,length:10}));i.a.render(r,o),t.bindPopup(n),t.on("popupclose",function(){i.a.unmountComponentAtNode(o),t.unbindPopup()}),this.popups.addLayer(n)}}},{key:"render",value:function(){return a.a.createElement("div",{id:"map",ref:this.ref})}}]),e}(a.a.Component);x.defaultProps={url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",center:[48.866667,2.333333],zoom:15,value:[]};var _=Object(h.a)(function(t,e){return t.stopPointsDiscovery},function(t){return t}),z=Object(u.b)(function(t,e){return{url:e.url,center:e.center,zoom:e.zoom,value:_(t,e)}},function(t){return{onClose:function(){return t(U.stopPointsDiscovery.failure({}))},onChange:function(e){var n;t((n=e,function(t){return T.get(n).subscribe(function(e){return t(D.stopPointsDiscovery.success(e))},function(e){return t(D.stopPointsDiscovery.failure(e))})}))}}})(x),V=(n(78),n(32)),F=n(53);n(79);V.b.add(F.a);var W=function(t){function e(){return Object(s.a)(this,e),Object(l.a)(this,Object(p.a)(e).apply(this,arguments))}return Object(m.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(z,{center:[48.866667,2.333333],zoom:15}))}}]),e}(a.a.Component);i.a.render(a.a.createElement(u.a,{store:y},a.a.createElement(W,null)),document.getElementById("root"))}},[[56,1,2]]]);
//# sourceMappingURL=main.86e01970.chunk.js.map