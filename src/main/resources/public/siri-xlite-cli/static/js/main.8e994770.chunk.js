(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{38:function(t,e,n){t.exports=n(61)},49:function(t,e,n){},50:function(t,e,n){},58:function(t,e,n){},60:function(t,e,n){},61:function(t,e,n){"use strict";n.r(e);var o=n(0),a=n.n(o),i=n(10),r=n.n(i),u=n(11),s=(n(49),n(12)),c=n(13),l=n(17),p=n(14),m=n(18),f=n(8),h=n(22),d=n(2),g=n(20),v=n(32),E=n(33),b=n.n(E),O=n(63),S=Object(O.a)({"LINES_DISCOVERY/SUCCESS":function(t,e){return Object.assign({},t,{linesDiscovery:e.payload})},"LINES_DISCOVERY/FAILURE":function(t,e){return Object.assign({},t,{linesDiscovery:{}})},"STOP_POINTS_DISCOVERY/SUCCESS":function(t,e){return Object.assign({},t,{stopPointsDiscovery:e.payload})},"STOP_POINTS_DISCOVERY/FAILURE":function(t,e){return Object.assign({},t,{stopPointsDiscovery:{}})},"STOP_MONITORING/SUCCESS":function(t,e){var n=Object.assign({},t);return n.stopMonitoring[e.meta.name]=e.payload,n},"STOP_MONITORING/FAILURE":function(t,e){var n=Object.assign({},t);return delete n.stopMonitoring[e.meta.name],n},"ESTIMATED_TIMETABLE/SUCCESS":function(t,e){var n=Object.assign({},t);return n.estimatedTimetable[e.meta.name]=e.payload,n},"ESTIMATED_TIMETABLE/FAILURE":function(t,e){var n=Object.assign({},t);return delete n.estimatedTimetable[e.meta.name],n}},{linesDiscovery:{},stopPointsDiscovery:{},stopMonitoring:{},estimatedTimetable:{}}),L=Object(g.c)(S,Object(g.a)(v.a,b.a)),y=(n(50),n(62)),j=n(16),I={get:function(t){var e=this.toTile(t["BoundingBox.UpperLeft.Longitude"],t["BoundingBox.UpperLeft.Latitude"],15),n=this.toTile(t["BoundingBox.LowerRight.Longitude"],t["BoundingBox.LowerRight.Latitude"],15);return console.log(e),console.log(n),fetch("/siri-xlite/stoppoints-discovery",{"Content-Type":"application/json"}).then(function(t){return t.json()})},toTile:function(t,e,n){return[Math.floor((t+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}},C={get:function(t){var e="";return e+="/siri-lite/stop-monitoring",e+=t&&"?"+Object.entries(t).map(function(t){var e=Object(j.a)(t,2),n=e[0],o=e[1];return"".concat(n,"=").concat(o)}).join("&"),fetch(e,{"Content-Type":"application/json"}).then(function(t){return t.json()})}},M=Object(y.a)({LINES_DISCOVERY:{SUCCESS:function(t){return t},FAILURE:function(t){return t}},STOP_POINTS_DISCOVERY:{SUCCESS:function(t){return t},FAILURE:function(t){return t}},STOP_MONITORING:{SUCCESS:[function(t){return t},function(t,e){return{name:e}}],FAILURE:[function(t){return t},function(t,e){return{name:e}}]},ESTIMATED_TIMETABLE:{SUCCESS:[function(t){return t},function(t,e){return{name:e}}],FAILURE:[function(t){return t},function(t,e){return{name:e}}]}}),T=M,P=n(34),k=n.n(P),D=n(35),R=(n(58),function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(l.a)(this,Object(p.a)(e).call(this,t))).counter=1,n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"initialize",value:function(){var t,e=this,n=(t={},Object(f.a)(t,"MonitoringRef",this.props.name),Object(f.a)(t,"MaximumStopVisits",this.props.length),Object(f.a)(t,"MaximumNumberOfCalls.Previous",0),Object(f.a)(t,"MaximumNumberOfCalls.Onwards",0),t);this.props.onChange(n),this.timer=setInterval(function(t){return e.counter++&&e.props.onChange(n)},1e4)}},{key:"dispose",value:function(){clearInterval(this.timer),this.props.onClose()}},{key:"render",value:function(){var t=function(t){return a.a.createElement("tr",null,a.a.createElement("th",{scope:"row"},a.a.createElement(k.a,{format:"HH:mm"},t.value.MonitoredCall.ExpectedDepartureTime)),a.a.createElement("td",{style:{textTransform:"uppercase"}},t.value.DestinationName),a.a.createElement("td",{style:{textTransform:"uppercase"}},t.value.PublishedLineName),a.a.createElement("td",null,a.a.createElement(D.a,{style:{color:"steelblue"},icon:"bus"})))};return a.a.createElement("div",null,a.a.createElement("h5",null,"#",this.counter," StopMonitoring: ",this.props.name),a.a.createElement("table",{className:"table table-sm table-hover"},a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Departure"),a.a.createElement("th",null,"Destination"),a.a.createElement("th",null,"Line"),a.a.createElement("th",null,"#"))),a.a.createElement("tbody",null,a.a.createElement(function(e){return e.values?e.values.map(function(e){return a.a.createElement(t,{value:e.MonitoredVehicleJourney,key:e.ItemIdentifier})}):null},{values:this.props.values}))))}}]),e}(a.a.Component)),U=Object(h.a)(function(t,e){return t.stopMonitoring[e.name]},function(t){return t?t.Siri.StopMonitoringDelivery.MonitoredStopVisit:[]}),N=Object(u.b)(function(t,e){return{name:e.name,length:e.length,values:U(t,e)}},function(t){return{onClose:function(){return t(T.stopMonitoring.failure({}))},onChange:function(e){var n,o;t((n=e,o=e.MonitoringRef,function(t){return C.get(n).then(function(e){return t(M.stopMonitoring.success(e,o))},function(e){return t(M.stopMonitoring.failure(e,o))})}))}}})(R),B=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(l.a)(this,Object(p.a)(e).call(this,t))).ref=a.a.createRef(),n}return Object(m.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"componentDidUpdate",value:function(){this.update(this.props.value.Siri)}},{key:"initialize",value:function(){this.stopPointIcon=d.icon({iconUrl:"images/marker-icon.png",shadowUrl:"images/marker-shadow.png"}),this.stopAreaIcon=d.icon({iconUrl:"images/marker-red-icon.png",shadowUrl:"images/marker-shadow.png"}),this.map=new d.map(this.ref.current,{center:d.latLng(this.props.center),zoom:this.props.zoom}),d.tileLayer(this.props.url,{}).addTo(this.map),this.markers=d.layerGroup([]).addTo(this.map),this.popups=d.layerGroup([]).addTo(this.map),d.control.scale().addTo(this.map),this.map.on("moveend",this.load,this),this.load()}},{key:"dispose",value:function(){this.props.onClose()}},{key:"load",value:function(){if(this.map.getZoom()>=this.props.zoom){var t=this.map.getBounds(),e=this.markers.getLayers().length;if(!this.bounds||!this.bounds.contains(t)||0===e){var n,o=this.diff(t.getEast(),t.getWest()),a=this.diff(t.getNorth(),t.getSouth());this.bounds=new d.LatLngBounds(new d.LatLng(t.getSouth()-a,t.getWest()-o),new d.LatLng(t.getNorth()+a,t.getEast()+o));var i=(n={},Object(f.a)(n,"BoundingBox.UpperLeft.Longitude",t.getNorthWest().lng),Object(f.a)(n,"BoundingBox.UpperLeft.Latitude",t.getNorthWest().lat),Object(f.a)(n,"BoundingBox.LowerRight.Longitude",t.getSouthEast().lng),Object(f.a)(n,"BoundingBox.LowerRight.Latitude",t.getSouthEast().lat),n);this.props.onChange(i)}}}},{key:"diff",value:function(t,e){return t*e>0?Math.abs(e-t):Math.abs(t)+Math.abs(e)}},{key:"update",value:function(t){var e=this;(this.markers.clearLayers(),this.popups.clearLayers(),t)&&t.StopPointsDelivery.AnnotatedStopPointRef.forEach(function(t){var n=d.latLng(t.Location.Latitude,t.Location.Longitude),o={title:t.StopName[0].value+"\n"+t.StopPointRef,alt:t.StopPointRef,icon:t.StopPointRef.startsWith("StopArea")?e.stopAreaIcon:e.stopPointIcon},a=d.marker(n,o);a.on("click",function(){e.createPopup(a)}),e.markers.addLayer(a)})}},{key:"createPopup",value:function(t){var e=t.getPopup();if(e)e.closePopup();else{var n=d.popup({autoClose:!1,closeOnClick:!1,closeButton:!1});n.setLatLng(t.getLatLng());var o=document.createElement("div");n.setContent(o);var i=a.a.createElement(u.a,{store:L},a.a.createElement(N,{name:t.options.alt,length:10}));r.a.render(i,o),t.bindPopup(n),t.on("popupclose",function(){r.a.unmountComponentAtNode(o),t.unbindPopup()}),this.popups.addLayer(n)}}},{key:"render",value:function(){return a.a.createElement("div",{id:"map",ref:this.ref})}}]),e}(a.a.Component);B.defaultProps={url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",zoom:17};var w=Object(h.a)(function(t,e){return t.stopPointsDiscovery},function(t){return t}),A=Object(u.b)(function(t,e){return{url:e.url,center:e.center,zoom:e.zoom,value:w(t,e)}},function(t){return{onClose:function(){return t(T.stopPointsDiscovery.failure({}))},onChange:function(e){var n;t((n=e,function(t){return I.get(n).then(function(e){return t(M.stopPointsDiscovery.success(e))},function(e){return t(M.stopPointsDiscovery.failure(e))})}))}}})(B),x=(n(59),n(21)),_=n(36);n(60);x.b.add(_.a);var z=function(t){function e(){return Object(s.a)(this,e),Object(l.a)(this,Object(p.a)(e).apply(this,arguments))}return Object(m.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(A,{center:[48.866667,2.333333]}))}}]),e}(a.a.Component);r.a.render(a.a.createElement(u.a,{store:L},a.a.createElement(z,null)),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.8e994770.chunk.js.map