{"version":3,"sources":["reducers.js","store.js","services/StopPointsDiscoveryService.js","types.js","services/StopMonitoringService.js","actions.js","components/stop-monitoring/StopMonitoringComponent.jsx","components/stop-points-discovery/StopPointsDiscoveryComponent.jsx","App.js","index.js"],"names":["reducers","handleActions","LINES_DISCOVERY/SUCCESS","state","action","Object","assign","linesDiscovery","payload","LINES_DISCOVERY/FAILURE","STOP_POINTS_DISCOVERY/SUCCESS","stopPointsDiscovery","STOP_POINTS_DISCOVERY/FAILURE","STOP_MONITORING/SUCCESS","result","stopMonitoring","meta","name","STOP_MONITORING/FAILURE","ESTIMATED_TIMETABLE/SUCCESS","estimatedTimetable","ESTIMATED_TIMETABLE/FAILURE","store","createStore","applyMiddleware","thunk","logger","StopPointsDiscoveryService","get","options","upperLeftTile","this","toTile","lowerRightTile","console","log","fetch","url","Content-Type","then","response","json","lon","lat","zoom","Math","floor","pow","tan","PI","cos","StopMonitoringService","entries","map","_ref","_ref2","slicedToArray","key","value","concat","join","actions","createActions","LINES_DISCOVERY","SUCCESS","FAILURE","STOP_POINTS_DISCOVERY","STOP_MONITORING","ESTIMATED_TIMETABLE","StopMonitoringComponent","props","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","counter","initialize","dispose","_options","_this2","defineProperty","length","onChange","timer","setInterval","e","clearInterval","onClose","Row","react_default","a","createElement","scope","dist_default","format","MonitoredCall","ExpectedDepartureTime","style","textTransform","DestinationName","PublishedLineName","index_es","color","icon","className","values","MonitoredVehicleJourney","ItemIdentifier","React","Component","selector","createSelector","Siri","StopMonitoringDelivery","MonitoredStopVisit","connect","dispatch","failure","stopMonitoringService","success","error","StopPointsDiscoveryComponent","ref","createRef","update","stopPointIcon","L","iconUrl","shadowUrl","stopAreaIcon","current","center","addTo","markers","popups","scale","on","load","getZoom","bounds","getBounds","count","getLayers","contains","dx","diff","getEast","getWest","dy","getNorth","getSouth","getNorthWest","lng","getSouthEast","b","abs","clearLayers","StopPointsDelivery","AnnotatedStopPointRef","forEach","i","latlng","Location","Latitude","Longitude","title","StopName","StopPointRef","alt","startsWith","marker","createPopup","addLayer","popup","getPopup","closePopup","autoClose","closeOnClick","closeButton","setLatLng","getLatLng","div","document","setContent","element","es","components_stop_monitoring_StopMonitoringComponent","ReactDOM","render","bindPopup","unmountComponentAtNode","unbindPopup","id","defaultProps","stopPointsDiscoveryService","library","add","faBus","App","components_stop_points_discovery_StopPointsDiscoveryComponent","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.8e994770.chunk.js","sourcesContent":["import { handleActions } from \"redux-actions\";\n\nconst reducers = handleActions(\n    {\n        \"LINES_DISCOVERY/SUCCESS\": (state, action) => {\n            return Object.assign({}, state, { linesDiscovery: action.payload })\n        },\n        \"LINES_DISCOVERY/FAILURE\": (state, action) => {\n            return Object.assign({}, state, { linesDiscovery: {} })\n        },\n        \"STOP_POINTS_DISCOVERY/SUCCESS\": (state, action) => {\n            return Object.assign({}, state, { stopPointsDiscovery: action.payload })\n        },\n        \"STOP_POINTS_DISCOVERY/FAILURE\": (state, action) => {\n            return Object.assign({}, state, { stopPointsDiscovery: {} })\n        },\n        \"STOP_MONITORING/SUCCESS\": (state, action) => {\n            let result = Object.assign({}, state);\n            result.stopMonitoring[action.meta.name] = action.payload;\n            return result;\n        },\n        \"STOP_MONITORING/FAILURE\": (state, action) => {\n            let result = Object.assign({}, state);\n            delete result.stopMonitoring[action.meta.name];\n            return result;\n        },\n        \"ESTIMATED_TIMETABLE/SUCCESS\": (state, action) => {\n            let result = Object.assign({}, state);\n            result.estimatedTimetable[action.meta.name] = action.payload;\n            return result;\n        },\n        \"ESTIMATED_TIMETABLE/FAILURE\": (state, action) => {\n            let result = Object.assign({}, state);\n            delete result.estimatedTimetable[action.meta.name];\n            return result;\n        }\n    },\n    {\n        linesDiscovery: {},\n        stopPointsDiscovery: {},\n        stopMonitoring: {},\n        estimatedTimetable: {}\n    }\n);\n\nexport default reducers;","import { createStore, applyMiddleware } from 'redux'\nimport thunk from 'redux-thunk'\nimport logger from 'redux-logger'\nimport reducers from './reducers'\n\nconst store = createStore(\n    reducers,\n    applyMiddleware(thunk, logger)\n);\n\nexport default store;\n","import * as T from \"../types\";\n\nconst StopPointsDiscoveryService = {\n    get: function (options) {\n        let url = (process.env.NODE_ENV !== \"production\") ? \"http://127.0.0.1\" : \"\"\n        url += \"/siri-xlite/stoppoints-discovery\";\n        // url += options && \"?\" + Object.entries(options).map(([key, value]) => `${key}=${value}`).join('&');\n        let upperLeftTile = this.toTile(options[T.UPPER_LEFT_LONGITUDE], options[T.UPPER_LEFT_LATITUDE],T.ZOOM);\n        let lowerRightTile = this.toTile(options[T.LOWER_RIGHT_LONGITUDE], options[T.LOWER_RIGHT_LATITUDE],T.ZOOM);\n\n        console.log(upperLeftTile);\n        console.log(lowerRightTile);\n\n        return fetch(url, {\n            \"Content-Type\": \"application/json\"\n        }).then(response => response.json());\n    },\n\n    toTile: function (lon, lat, zoom) { \n        let result = [ Math.floor((lon+180)/360*Math.pow(2,zoom)), \n            Math.floor((1-Math.log(Math.tan(lat*Math.PI/180) + 1/Math.cos(lat*Math.PI/180))/Math.PI)/2 *Math.pow(2,zoom))];\n        return result;\n    }\n};\n\nexport default StopPointsDiscoveryService;\n","export const UPPER_LEFT_LONGITUDE = \"BoundingBox.UpperLeft.Longitude\";\nexport const UPPER_LEFT_LATITUDE = \"BoundingBox.UpperLeft.Latitude\";\nexport const LOWER_RIGHT_LONGITUDE = \"BoundingBox.LowerRight.Longitude\";\nexport const LOWER_RIGHT_LATITUDE = \"BoundingBox.LowerRight.Latitude\";\n\nexport const MONITORING_REF = \"MonitoringRef\";\nexport const MAXIMUM_STOP_VISITS = \"MaximumStopVisits\";\nexport const MAXIMUM_NUMBER_CALLS_OF_ONWARDS = \"MaximumNumberOfCalls.Onwards\";\nexport const MAXIMUM_NUMBER_CALLS_OF_PREVIOUS = \"MaximumNumberOfCalls.Previous\";\n\nexport const ZOOM = 15;\n","const StopMonitoringService = {\n    get: function (options) {\n        let url = (process.env.NODE_ENV !== \"production\") ? \"http://127.0.0.1:8080\" : \"\"\n        url += \"/siri-lite/stop-monitoring\"\n        url += options && \"?\" + Object.entries(options).map(([key, value]) => `${key}=${value}`).join('&');\n        return fetch(url, {\n            \"Content-Type\": \"application/json\"\n        }).then(response => response.json());\n    }\n};\n\nexport default StopMonitoringService;","import { createActions } from 'redux-actions';\nimport linesDiscoveryService from \"./services/LinesDiscoveryService\";\nimport stopPointsDiscoveryService from \"./services/StopPointsDiscoveryService\";\nimport stopMonitoringService from \"./services/StopMonitoringService\";\nimport estimatedTimetableService from \"./services/EstimatedTimetableService\";\n\nexport const loadLinesDiscovery = (payload) => dispatch => {\n    return linesDiscoveryService.get(payload).then(\n        value => dispatch(actions.linesDiscovery.success(value)),\n        error => dispatch(actions.linesDiscovery.failure(error))\n    );\n};\n\nexport const loadStopPointsDiscovery = (payload) => dispatch => {\n    return stopPointsDiscoveryService.get(payload).then(\n        value => dispatch(actions.stopPointsDiscovery.success(value)),\n        error => dispatch(actions.stopPointsDiscovery.failure(error))\n    );\n};\n\nexport const loadStopMonitoring = (payload, name) => dispatch => {\n    return stopMonitoringService.get(payload).then(\n        value => dispatch(actions.stopMonitoring.success(value, name)),\n        error => dispatch(actions.stopMonitoring.failure(error, name))\n    );\n};\n\nexport const loadEstimatedTimetable = (payload, name) => dispatch => {\n    return estimatedTimetableService.get(payload).then(\n        value => dispatch(actions.estimatedTimetable.success(value, name)),\n        error => dispatch(actions.estimatedTimetable.failure(error, name))\n    );\n};\n\nconst actions = createActions(\n    {\n        LINES_DISCOVERY: {\n            SUCCESS: payload => payload,\n            FAILURE: payload => payload\n        },\n        STOP_POINTS_DISCOVERY: {\n            SUCCESS: payload => payload,\n            FAILURE: payload => payload\n        },\n        STOP_MONITORING: {\n            SUCCESS: [\n                payload => payload,\n                (payload, name) => ({ name })\n            ],\n            FAILURE: [\n                payload => payload,\n                (payload, name) => ({ name })\n            ],\n        },\n        ESTIMATED_TIMETABLE: {\n            SUCCESS: [\n                payload => payload,\n                (payload, name) => ({ name })\n            ],\n            FAILURE: [\n                payload => payload,\n                (payload, name) => ({ name })\n            ],\n        }\n    }\n);\n\nexport default actions;\n","import React from \"react\";\nimport { connect } from 'react-redux'\nimport PropTypes from \"prop-types\";\nimport { createSelector } from 'reselect'\nimport Moment from 'react-moment';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\n\nimport actions, { loadStopMonitoring } from \"../../actions\";\nimport * as T from \"../../types\";\nimport \"./StopMonitoringComponent.scss\"\n\nclass StopMonitoringComponent extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.counter = 1;\n    }\n\n    componentDidMount() {\n        this.initialize();\n    }\n\n    componentWillUnmount() {\n        this.dispose();\n    }\n\n    initialize() {\n        const options = {\n            [T.MONITORING_REF]: this.props.name,\n            [T.MAXIMUM_STOP_VISITS]: this.props.length,\n            [T.MAXIMUM_NUMBER_CALLS_OF_PREVIOUS]: 0,\n            [T.MAXIMUM_NUMBER_CALLS_OF_ONWARDS]: 0,\n        };\n        this.props.onChange(options);\n        this.timer = setInterval((e) => this.counter++ && this.props.onChange(options), 10000);\n    }\n\n    dispose() {\n        clearInterval(this.timer);\n        this.props.onClose();\n    }\n\n    render() {\n\n        const Row = (props) => {\n            return (<tr >\n                <th scope=\"row\"><Moment format=\"HH:mm\">{props.value.MonitoredCall.ExpectedDepartureTime}</Moment></th>\n                <td style={{ textTransform: 'uppercase' }}>{props.value.DestinationName}</td>\n                <td style={{ textTransform: 'uppercase' }}>{props.value.PublishedLineName}</td>\n                <td>\n                    <FontAwesomeIcon style={{ color: \"steelblue\" }} icon=\"bus\" />\n                </td>\n            </tr>)\n        }\n\n        const Rows = (props) => {\n            return (props.values) ? props.values.map((value) => <Row value={value.MonitoredVehicleJourney} key={value.ItemIdentifier} />) : (null);\n        }\n\n        return (<div>\n            <h5>#{this.counter} StopMonitoring: {this.props.name}</h5>\n            <table className=\"table table-sm table-hover\">\n                <thead>\n                    <tr>\n                        <th>Departure</th>\n                        <th>Destination</th>\n                        <th>Line</th>\n                        <th>#</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <Rows values={this.props.values} />\n                </tbody>\n            </table>\n        </div >);\n    }\n}\n\nStopMonitoringComponent.propTypes = {\n    name: PropTypes.string.isRequired,\n    length: PropTypes.number.isRequired,\n    values: PropTypes.array.isRequired,\n    onChange: PropTypes.func.isRequired,\n    onClose: PropTypes.func.isRequired\n};\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        onClose: () => dispatch(actions.stopMonitoring.failure({})),\n        onChange: (options) => {\n            dispatch(loadStopMonitoring(options, options[T.MONITORING_REF]));\n        }\n    }\n}\n\nconst selector = createSelector((state, props) => state.stopMonitoring[props.name],\n    value => value ? value.Siri.StopMonitoringDelivery.MonitoredStopVisit : []);\n\nconst mapStateToProps = (state, props) => {\n    return {\n        name: props.name,\n        length: props.length,\n        values: selector(state, props)\n    };\n}\n\nexport default connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(StopMonitoringComponent);","import React from \"react\";\nimport ReactDOM from 'react-dom';\nimport PropTypes from \"prop-types\";\nimport { Provider, connect } from \"react-redux\";\nimport { createSelector } from 'reselect'\nimport * as L from \"leaflet\";\n\nimport store from \"../../store\"\nimport \"./StopPointsDiscoveryComponent.scss\";\nimport actions, { loadStopPointsDiscovery } from \"../../actions\";\nimport * as T from \"../../types\";\nimport StopMonitoringComponent from \"../stop-monitoring/StopMonitoringComponent\";\n\nclass StopPointsDiscoveryComponent extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.ref = React.createRef();\n    }\n\n    componentDidMount() {\n        this.initialize();\n    }\n\n    componentWillUnmount() {\n        this.dispose();\n    }\n\n    componentDidUpdate() {\n        this.update(this.props.value.Siri);\n    }\n\n    initialize() {\n        this.stopPointIcon = L.icon({\n            iconUrl: \"images/marker-icon.png\",\n            shadowUrl: \"images/marker-shadow.png\"\n        });\n\n        this.stopAreaIcon = L.icon({\n            iconUrl: \"images/marker-red-icon.png\",\n            shadowUrl: \"images/marker-shadow.png\"\n        });\n\n        this.map = new L.map(this.ref.current, {\n            center: L.latLng(this.props.center),\n            zoom: this.props.zoom\n        });\n        L.tileLayer(this.props.url, {}).addTo(this.map);\n        this.markers = L.layerGroup([]).addTo(this.map);\n        this.popups = L.layerGroup([]).addTo(this.map);\n        L.control.scale().addTo(this.map);\n\n        this.map.on(\"moveend\", this.load, this);\n        this.load();\n    }\n\n    dispose() {\n        this.props.onClose();\n    }\n\n    load() {\n        if (this.map.getZoom() >= this.props.zoom) {\n            let bounds = this.map.getBounds();\n            let count = this.markers.getLayers().length;\n            if (!this.bounds || !this.bounds.contains(bounds) || count === 0) {\n                let dx = this.diff(bounds.getEast(), bounds.getWest());\n                let dy = this.diff(bounds.getNorth(), bounds.getSouth());\n                this.bounds = new L.LatLngBounds(\n                    new L.LatLng(bounds.getSouth() - dy, bounds.getWest() - dx),\n                    new L.LatLng(bounds.getNorth() + dy, bounds.getEast() + dx)\n                );\n                const options = {\n                    [T.UPPER_LEFT_LONGITUDE]: bounds.getNorthWest().lng,\n                    [T.UPPER_LEFT_LATITUDE]: bounds.getNorthWest().lat,\n                    [T.LOWER_RIGHT_LONGITUDE]: bounds.getSouthEast().lng,\n                    [T.LOWER_RIGHT_LATITUDE]: bounds.getSouthEast().lat,\n                };\n                this.props.onChange(options);\n            }\n        }\n    }\n\n    diff(a, b) {\n        let result = a * b > 0 ? Math.abs(b - a) : Math.abs(a) + Math.abs(b);\n        return result;\n    }\n\n    update(value) {\n        this.markers.clearLayers();\n        this.popups.clearLayers();\n        if (value) {\n            let array = value.StopPointsDelivery.AnnotatedStopPointRef;\n\n            array.forEach(i => {\n                let latlng = L.latLng(i.Location.Latitude, i.Location.Longitude);\n                let options = {\n                    title: i.StopName[\"0\"].value + \"\\n\" + i.StopPointRef,\n                    alt: i.StopPointRef,\n                    icon: i.StopPointRef.startsWith(\"StopArea\")\n                        ? this.stopAreaIcon\n                        : this.stopPointIcon\n                };\n                let marker = L.marker(latlng, options);\n                marker.on(\"click\", () => {\n                    this.createPopup(marker);\n                });\n                this.markers.addLayer(marker);\n            });\n        }\n    }\n\n    createPopup(marker) {\n        let popup = marker.getPopup();\n        if (popup) {\n            popup.closePopup();\n        } else {\n            let popup = L.popup({\n                autoClose: false,\n                closeOnClick: false,\n                closeButton: false\n            });\n            popup.setLatLng(marker.getLatLng());\n\n            let div = document.createElement('div');\n            popup.setContent(div);\n            const element = <Provider store={store}><StopMonitoringComponent name={marker.options.alt} length={10} /></Provider>;\n            ReactDOM.render(element, div);\n\n            marker.bindPopup(popup);\n            marker.on(\"popupclose\", () => {\n                ReactDOM.unmountComponentAtNode(div);\n                marker.unbindPopup();\n            });\n            this.popups.addLayer(popup);\n        }\n    }\n\n    render() {\n        return (<div id=\"map\" ref={this.ref} />);\n    }\n}\n\nStopPointsDiscoveryComponent.propTypes = {\n    url: PropTypes.string.isRequired,\n    center: PropTypes.array.isRequired,\n    zoom: PropTypes.number.isRequired,\n    value: PropTypes.object.isRequired,\n    onChange: PropTypes.func.isRequired,\n    onClose: PropTypes.func.isRequired\n};\n\nStopPointsDiscoveryComponent.defaultProps = {\n    url: \"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n    zoom: 17\n};\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        onClose: () => dispatch(actions.stopPointsDiscovery.failure({})),\n        onChange: (options) => {\n            dispatch(loadStopPointsDiscovery(options));\n        }\n    }\n}\n\nconst selector = createSelector((state, props) => state.stopPointsDiscovery, value => value);\n\nconst mapStateToProps = (state, props) => {\n    return {\n        url: props.url,\n        center: props.center,\n        zoom: props.zoom,\n        value: selector(state, props)\n    };\n}\n\nexport default connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(StopPointsDiscoveryComponent);","import React from \"react\";\nimport StopPointsDiscoveryComponent from \"./components/stop-points-discovery/StopPointsDiscoveryComponent\";\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { faBus } from '@fortawesome/free-solid-svg-icons'\nimport \"./App.scss\";\n\nlibrary.add(faBus)\n\nclass App extends React.Component {\n\n  render() {\n    return (\n      <div className=\"App\">\n        <StopPointsDiscoveryComponent center={[48.866667, 2.333333]} />\n      </div>\n    );\n  }\n}\n\nexport default App;","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\"\n\nimport \"./index.scss\";\nimport App from \"./App\";\nimport store from \"./store\"\n\nReactDOM.render(\n    <Provider store={store}>\n        <App />\n    </Provider>, document.getElementById('root'));"],"sourceRoot":""}