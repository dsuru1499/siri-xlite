{"version":3,"sources":["reducers.js","store.js","services/StopPointsDiscoveryService.js","types.js","services/StopMonitoringService.js","actions.js","components/stop-monitoring/StopMonitoringComponent.jsx","components/stop-points-discovery/StopPointsDiscoveryComponent.jsx","App.js","index.js"],"names":["reducers","handleActions","LINES_DISCOVERY/SUCCESS","state","action","Object","assign","linesDiscovery","payload","LINES_DISCOVERY/FAILURE","STOP_POINTS_DISCOVERY/SUCCESS","stopPointsDiscovery","STOP_POINTS_DISCOVERY/FAILURE","STOP_MONITORING/SUCCESS","result","stopMonitoring","meta","name","STOP_MONITORING/FAILURE","ESTIMATED_TIMETABLE/SUCCESS","estimatedTimetable","ESTIMATED_TIMETABLE/FAILURE","store","createStore","applyMiddleware","thunk","logger","StopPointsDiscoveryService","get","options","_this","this","upperLeftTile","toTile","lowerRightTile","query","pipe","mergeMap","url","request","lon","lat","zoom","Math","floor","pow","log","tan","PI","cos","from","to","Observable","create","observer","x","y","next","complete","fetch","Content-Type","then","response","json","StopMonitoringService","entries","map","_ref","_ref2","slicedToArray","key","value","concat","join","actions","createActions","LINES_DISCOVERY","SUCCESS","FAILURE","STOP_POINTS_DISCOVERY","STOP_MONITORING","ESTIMATED_TIMETABLE","StopMonitoringComponent","props","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","counter","initialize","dispose","_options","_this2","defineProperty","length","onChange","timer","setInterval","e","clearInterval","onClose","Row","react_default","a","createElement","scope","dist_default","format","MonitoredCall","ExpectedDepartureTime","style","textTransform","DestinationName","PublishedLineName","index_es","color","icon","className","values","MonitoredVehicleJourney","ItemIdentifier","React","Component","selector","createSelector","Siri","StopMonitoringDelivery","MonitoredStopVisit","connect","dispatch","failure","stopMonitoringService","success","error","StopPointsDiscoveryComponent","ref","createRef","update","stopPointIcon","L","iconUrl","shadowUrl","stopAreaIcon","current","center","addTo","markers","popups","scale","on","load","getZoom","bounds","getBounds","count","getLayers","contains","dx","diff","getEast","getWest","dy","getNorth","getSouth","getNorthWest","lng","getSouthEast","b","abs","clearLayers","StopPointsDelivery","AnnotatedStopPointRef","forEach","i","latlng","Location","Latitude","Longitude","title","StopName","StopPointRef","alt","startsWith","marker","createPopup","addLayer","popup","getPopup","closePopup","autoClose","closeOnClick","closeButton","setLatLng","getLatLng","div","document","setContent","element","es","components_stop_monitoring_StopMonitoringComponent","ReactDOM","render","bindPopup","unmountComponentAtNode","unbindPopup","id","defaultProps","stopPointsDiscoveryService","subscribe","library","add","faBus","App","components_stop_points_discovery_StopPointsDiscoveryComponent","src_App_0","getElementById"],"mappings":"qXA6CeA,EA3CEC,YACb,CACIC,0BAA2B,SAACC,EAAOC,GAC/B,OAAOC,OAAOC,OAAO,GAAIH,EAAO,CAAEI,eAAgBH,EAAOI,WAE7DC,0BAA2B,SAACN,EAAOC,GAC/B,OAAOC,OAAOC,OAAO,GAAIH,EAAO,CAAEI,eAAgB,MAEtDG,gCAAiC,SAACP,EAAOC,GACrC,OAAOC,OAAOC,OAAO,GAAIH,EAAO,CAAEQ,oBAAqBP,EAAOI,WAElEI,gCAAiC,SAACT,EAAOC,GACrC,OAAOC,OAAOC,OAAO,GAAIH,EAAO,CAAEQ,oBAAqB,MAE3DE,0BAA2B,SAACV,EAAOC,GAC/B,IAAIU,EAAST,OAAOC,OAAO,GAAIH,GAE/B,OADAW,EAAOC,eAAeX,EAAOY,KAAKC,MAAQb,EAAOI,QAC1CM,GAEXI,0BAA2B,SAACf,EAAOC,GAC/B,IAAIU,EAAST,OAAOC,OAAO,GAAIH,GAE/B,cADOW,EAAOC,eAAeX,EAAOY,KAAKC,MAClCH,GAEXK,8BAA+B,SAAChB,EAAOC,GACnC,IAAIU,EAAST,OAAOC,OAAO,GAAIH,GAE/B,OADAW,EAAOM,mBAAmBhB,EAAOY,KAAKC,MAAQb,EAAOI,QAC9CM,GAEXO,8BAA+B,SAAClB,EAAOC,GACnC,IAAIU,EAAST,OAAOC,OAAO,GAAIH,GAE/B,cADOW,EAAOM,mBAAmBhB,EAAOY,KAAKC,MACtCH,IAGf,CACIP,eAAgB,GAChBI,oBAAqB,GACrBI,eAAgB,GAChBK,mBAAoB,KC/BbE,EALDC,YACVvB,EACAwB,YAAgBC,IAAOC,qDC+BZC,EAlCoB,CAC/BC,IAAK,SAAUC,GAAS,IAAAC,EAAAC,KAChBC,EAAgBD,KAAKE,OAAOJ,ECNJ,mCDMqCA,ECLtC,kCASf,IDHRK,EAAiBH,KAAKE,OAAOJ,ECLJ,oCDKsCA,ECJvC,mCAOhB,IDDZ,OAAOE,KAAKI,MAAMH,EAAeE,GAAgBE,KAAKC,YAAS,SAAAC,GAAG,OAAIR,EAAKS,QAAQD,OAGvFL,OAAQ,SAAUO,EAAKC,EAAKC,GAGxB,MAFa,CAACC,KAAKC,OAAOJ,EAAM,KAAO,IAAMG,KAAKE,IAAI,EAAGH,IACzDC,KAAKC,OAAO,EAAID,KAAKG,IAAIH,KAAKI,IAAIN,EAAME,KAAKK,GAAK,KAAO,EAAIL,KAAKM,IAAIR,EAAME,KAAKK,GAAK,MAAQL,KAAKK,IAAM,EAAIL,KAAKE,IAAI,EAAGH,MAI7HP,MAAO,SAAUe,EAAMC,GACnB,OAAOC,IAAWC,OAAO,SAAUC,GAC/B,IAAK,IAAIC,EAAIL,EAAK,GAAIK,GAAKL,EAAK,GAAIK,IAChC,IAAK,IAAIC,EAAIL,EAAG,GAAIK,GAAKL,EAAG,GAAIK,IAAK,CACjC,IAAIlB,EAAqE,GACzEA,GAAO,oCAAsCiB,EAAI,IAAMC,EACvDF,EAASG,KAAKnB,GAGtBgB,EAASI,cAIjBnB,QAAS,SAAUD,GACf,OAAOY,YAAKS,MAAMrB,EAAK,CACnBsB,eAAgB,qBACjBC,KAAK,SAAAC,GAAQ,OAAIA,EAASC,YEvBtBC,EAXe,CAC1BpC,IAAK,SAAUC,GACX,IAAIS,EAA0E,GAG9E,OAFAA,GAAO,6BACPA,GAAOT,GAAW,IAAMxB,OAAO4D,QAAQpC,GAASqC,IAAI,SAAAC,GAAA,IAAAC,EAAA/D,OAAAgE,EAAA,EAAAhE,CAAA8D,EAAA,GAAEG,EAAFF,EAAA,GAAOG,EAAPH,EAAA,YAAAI,OAAqBF,EAArB,KAAAE,OAA4BD,KAASE,KAAK,KACvFd,MAAMrB,EAAK,CACdsB,eAAgB,qBACjBC,KAAK,SAAAC,GAAQ,OAAIA,EAASC,WC2B/BW,EAAUC,YACZ,CACIC,gBAAiB,CACbC,QAAS,SAAArE,GAAO,OAAIA,GACpBsE,QAAS,SAAAtE,GAAO,OAAIA,IAExBuE,sBAAuB,CACnBF,QAAS,SAAArE,GAAO,OAAIA,GACpBsE,QAAS,SAAAtE,GAAO,OAAIA,IAExBwE,gBAAiB,CACbH,QAAS,CACL,SAAArE,GAAO,OAAIA,GACX,SAACA,EAASS,GAAV,MAAoB,CAAEA,UAE1B6D,QAAS,CACL,SAAAtE,GAAO,OAAIA,GACX,SAACA,EAASS,GAAV,MAAoB,CAAEA,WAG9BgE,oBAAqB,CACjBJ,QAAS,CACL,SAAArE,GAAO,OAAIA,GACX,SAACA,EAASS,GAAV,MAAoB,CAAEA,UAE1B6D,QAAS,CACL,SAAAtE,GAAO,OAAIA,GACX,SAACA,EAASS,GAAV,MAAoB,CAAEA,aAMvByD,6BCxDTQ,qBAEF,SAAAA,EAAYC,GAAO,IAAArD,EAAA,OAAAzB,OAAA+E,EAAA,EAAA/E,CAAA0B,KAAAmD,IACfpD,EAAAzB,OAAAgF,EAAA,EAAAhF,CAAA0B,KAAA1B,OAAAiF,EAAA,EAAAjF,CAAA6E,GAAAK,KAAAxD,KAAMoD,KACDK,QAAU,EAFA1D,mFAMfC,KAAK0D,4DAIL1D,KAAK2D,+CAGI,IAAAC,EAAAC,EAAA7D,KACHF,GAAO8D,EAAA,GAAAtF,OAAAwF,EAAA,EAAAxF,CAAAsF,EHtBS,gBGuBE5D,KAAKoD,MAAMlE,MADtBZ,OAAAwF,EAAA,EAAAxF,CAAAsF,EHrBc,oBGuBE5D,KAAKoD,MAAMW,QAF3BzF,OAAAwF,EAAA,EAAAxF,CAAAsF,EHnB2B,gCGsBE,GAH7BtF,OAAAwF,EAAA,EAAAxF,CAAAsF,EHpB0B,+BGwBE,GAJ5BA,GAMb5D,KAAKoD,MAAMY,SAASlE,GACpBE,KAAKiE,MAAQC,YAAY,SAACC,GAAD,OAAON,EAAKJ,WAAaI,EAAKT,MAAMY,SAASlE,IAAU,uCAIhFsE,cAAcpE,KAAKiE,OACnBjE,KAAKoD,MAAMiB,2CAKX,IAAMC,EAAM,SAAClB,GACT,OAAQmB,EAAAC,EAAAC,cAAA,UACJF,EAAAC,EAAAC,cAAA,MAAIC,MAAM,OAAMH,EAAAC,EAAAC,cAACE,EAAAH,EAAD,CAAQI,OAAO,SAASxB,EAAMZ,MAAMqC,cAAcC,wBAClEP,EAAAC,EAAAC,cAAA,MAAIM,MAAO,CAAEC,cAAe,cAAgB5B,EAAMZ,MAAMyC,iBACxDV,EAAAC,EAAAC,cAAA,MAAIM,MAAO,CAAEC,cAAe,cAAgB5B,EAAMZ,MAAM0C,mBACxDX,EAAAC,EAAAC,cAAA,UACIF,EAAAC,EAAAC,cAACU,EAAA,EAAD,CAAiBJ,MAAO,CAAEK,MAAO,aAAeC,KAAK,WASjE,OAAQd,EAAAC,EAAAC,cAAA,WACJF,EAAAC,EAAAC,cAAA,cAAMzE,KAAKyD,QAAX,oBAAqCzD,KAAKoD,MAAMlE,MAChDqF,EAAAC,EAAAC,cAAA,SAAOa,UAAU,8BACbf,EAAAC,EAAAC,cAAA,aACIF,EAAAC,EAAAC,cAAA,UACIF,EAAAC,EAAAC,cAAA,uBACAF,EAAAC,EAAAC,cAAA,yBACAF,EAAAC,EAAAC,cAAA,kBACAF,EAAAC,EAAAC,cAAA,iBAGRF,EAAAC,EAAAC,cAAA,aACIF,EAAAC,EAAAC,cAhBC,SAACrB,GACV,OAAQA,EAAMmC,OAAUnC,EAAMmC,OAAOpD,IAAI,SAACK,GAAD,OAAW+B,EAAAC,EAAAC,cAACH,EAAD,CAAK9B,MAAOA,EAAMgD,wBAAyBjD,IAAKC,EAAMiD,mBAAuB,MAezH,CAAMF,OAAQvF,KAAKoD,MAAMmC,mBA5DPG,IAAMC,YAoFtCC,EAAWC,YAAe,SAACzH,EAAOgF,GAAR,OAAkBhF,EAAMY,eAAeoE,EAAMlE,OACzE,SAAAsD,GAAK,OAAIA,EAAQA,EAAMsD,KAAKC,uBAAuBC,mBAAqB,KAU7DC,cARS,SAAC7H,EAAOgF,GAC5B,MAAO,CACHlE,KAAMkE,EAAMlE,KACZ6E,OAAQX,EAAMW,OACdwB,OAAQK,EAASxH,EAAOgF,KAhBL,SAAC8C,GACxB,MAAO,CACH7B,QAAS,kBAAM6B,EAASvD,EAAQ3D,eAAemH,QAAQ,MACvDnC,SAAU,SAAClE,GDrEe,IAACrB,EAASS,ECsEhCgH,GDtEuBzH,ECsEKqB,EDtEIZ,ECsEKY,EAAO,cDtEH,SAAAoG,GACjD,OAAOE,EAAsBvG,IAAIpB,GAASqD,KACtC,SAAAU,GAAK,OAAI0D,EAASvD,EAAQ3D,eAAeqH,QAAQ7D,EAAOtD,KACxD,SAAAoH,GAAK,OAAIJ,EAASvD,EAAQ3D,eAAemH,QAAQG,EAAOpH,YCmFjD+G,CAGb9C,GChGIoD,cAEF,SAAAA,EAAYnD,GAAO,IAAArD,EAAA,OAAAzB,OAAA+E,EAAA,EAAA/E,CAAA0B,KAAAuG,IACfxG,EAAAzB,OAAAgF,EAAA,EAAAhF,CAAA0B,KAAA1B,OAAAiF,EAAA,EAAAjF,CAAAiI,GAAA/C,KAAAxD,KAAMoD,KACDoD,IAAMd,IAAMe,YAFF1G,mFAMfC,KAAK0D,4DAIL1D,KAAK2D,uDAIL3D,KAAK0G,OAAO1G,KAAKoD,MAAMZ,MAAMsD,2CAI7B9F,KAAK2G,cAAgBC,OAAO,CACxBC,QAAS,yBACTC,UAAW,6BAGf9G,KAAK+G,aAAeH,OAAO,CACvBC,QAAS,6BACTC,UAAW,6BAGf9G,KAAKmC,IAAM,IAAIyE,MAAM5G,KAAKwG,IAAIQ,QAAS,CACnCC,OAAQL,SAAS5G,KAAKoD,MAAM6D,QAC5BtG,KAAMX,KAAKoD,MAAMzC,OAErBiG,YAAY5G,KAAKoD,MAAM7C,IAAK,IAAI2G,MAAMlH,KAAKmC,KAC3CnC,KAAKmH,QAAUP,aAAa,IAAIM,MAAMlH,KAAKmC,KAC3CnC,KAAKoH,OAASR,aAAa,IAAIM,MAAMlH,KAAKmC,KAC1CyE,UAAUS,QAAQH,MAAMlH,KAAKmC,KAE7BnC,KAAKmC,IAAImF,GAAG,UAAWtH,KAAKuH,KAAMvH,MAClCA,KAAKuH,yCAILvH,KAAKoD,MAAMiB,yCAIX,GAAIrE,KAAKmC,IAAIqF,WAAaxH,KAAKoD,MAAMzC,KAAM,CACvC,IAAI8G,EAASzH,KAAKmC,IAAIuF,YAClBC,EAAQ3H,KAAKmH,QAAQS,YAAY7D,OACrC,IAAK/D,KAAKyH,SAAWzH,KAAKyH,OAAOI,SAASJ,IAAqB,IAAVE,EAAa,KAAA/D,EAC1DkE,EAAK9H,KAAK+H,KAAKN,EAAOO,UAAWP,EAAOQ,WACxCC,EAAKlI,KAAK+H,KAAKN,EAAOU,WAAYV,EAAOW,YAC7CpI,KAAKyH,OAAS,IAAIb,eACd,IAAIA,SAASa,EAAOW,WAAaF,EAAIT,EAAOQ,UAAYH,GACxD,IAAIlB,SAASa,EAAOU,WAAaD,EAAIT,EAAOO,UAAYF,IAE5D,IAAMhI,GAAO8D,EAAA,GAAAtF,OAAAwF,EAAA,EAAAxF,CAAAsF,EJvEO,kCIwEU6D,EAAOY,eAAeC,KADvChK,OAAAwF,EAAA,EAAAxF,CAAAsF,EJtEM,iCIwEU6D,EAAOY,eAAe3H,KAFtCpC,OAAAwF,EAAA,EAAAxF,CAAAsF,EJrEQ,mCIwEU6D,EAAOc,eAAeD,KAHxChK,OAAAwF,EAAA,EAAAxF,CAAAsF,EJpEO,kCIwEU6D,EAAOc,eAAe7H,KAJvCkD,GAMb5D,KAAKoD,MAAMY,SAASlE,kCAK3B0E,EAAGgE,GAEJ,OADahE,EAAIgE,EAAI,EAAI5H,KAAK6H,IAAID,EAAIhE,GAAK5D,KAAK6H,IAAIjE,GAAK5D,KAAK6H,IAAID,kCAI/DhG,GAAO,IAAAqB,EAAA7D,MACVA,KAAKmH,QAAQuB,cACb1I,KAAKoH,OAAOsB,cACRlG,IACYA,EAAMmG,mBAAmBC,sBAE/BC,QAAQ,SAAAC,GACV,IAAIC,EAASnC,SAASkC,EAAEE,SAASC,SAAUH,EAAEE,SAASE,WAClDpJ,EAAU,CACVqJ,MAAOL,EAAEM,SAAS,GAAK5G,MAAQ,KAAOsG,EAAEO,aACxCC,IAAKR,EAAEO,aACPhE,KAAMyD,EAAEO,aAAaE,WAAW,YAC1B1F,EAAKkD,aACLlD,EAAK8C,eAEX6C,EAAS5C,SAASmC,EAAQjJ,GAC9B0J,EAAOlC,GAAG,QAAS,WACfzD,EAAK4F,YAAYD,KAErB3F,EAAKsD,QAAQuC,SAASF,yCAKtBA,GACR,IAAIG,EAAQH,EAAOI,WACnB,GAAID,EACAA,EAAME,iBACH,CACH,IAAIF,EAAQ/C,QAAQ,CAChBkD,WAAW,EACXC,cAAc,EACdC,aAAa,IAEjBL,EAAMM,UAAUT,EAAOU,aAEvB,IAAIC,EAAMC,SAAS3F,cAAc,OACjCkF,EAAMU,WAAWF,GACjB,IAAMG,EAAU/F,EAAAC,EAAAC,cAAC8F,EAAA,EAAD,CAAUhL,MAAOA,GAAOgF,EAAAC,EAAAC,cAAC+F,EAAD,CAAyBtL,KAAMsK,EAAO1J,QAAQwJ,IAAKvF,OAAQ,MACnG0G,IAASC,OAAOJ,EAASH,GAEzBX,EAAOmB,UAAUhB,GACjBH,EAAOlC,GAAG,aAAc,WACpBmD,IAASG,uBAAuBT,GAChCX,EAAOqB,gBAEX7K,KAAKoH,OAAOsC,SAASC,qCAKzB,OAAQpF,EAAAC,EAAAC,cAAA,OAAKqG,GAAG,MAAMtE,IAAKxG,KAAKwG,aA7HGd,IAAMC,WA0IjDY,EAA6BwE,aAAe,CACxCxK,IAAK,oDACLI,KAAM,IAGV,IASMiF,EAAWC,YAAe,SAACzH,EAAOgF,GAAR,OAAkBhF,EAAMQ,qBAAqB,SAAA4D,GAAK,OAAIA,IAWvEyD,cATS,SAAC7H,EAAOgF,GAC5B,MAAO,CACH7C,IAAK6C,EAAM7C,IACX0G,OAAQ7D,EAAM6D,OACdtG,KAAMyC,EAAMzC,KACZ6B,MAAOoD,EAASxH,EAAOgF,KAhBJ,SAAC8C,GACxB,MAAO,CACH7B,QAAS,kBAAM6B,EAASvD,EAAQ/D,oBAAoBuH,QAAQ,MAC5DnC,SAAU,SAAClE,GFlJoB,IAACrB,EEmJ5ByH,GFnJ4BzH,EEmJKqB,EFnJO,SAAAoG,GAChD,OAAO8E,EAA2BnL,IAAIpB,GAASwM,UAC3C,SAAAzI,GAAK,OAAI0D,EAASvD,EAAQ/D,oBAAoByH,QAAQ7D,KACtD,SAAA8D,GAAK,OAAIJ,EAASvD,EAAQ/D,oBAAoBuH,QAAQG,YEgK/CL,CAGbM,iCC5KF2E,IAAQC,IAAIC,SAaGC,mLARX,OACE9G,EAAAC,EAAAC,cAAA,OAAKa,UAAU,OACbf,EAAAC,EAAAC,cAAC6G,EAAD,CAA8BrE,OAAQ,CAAC,UAAW,oBALxCvB,IAAMC,WCDxB8E,IAASC,OACLnG,EAAAC,EAAAC,cAAC8F,EAAA,EAAD,CAAUhL,MAAOA,GACbgF,EAAAC,EAAAC,cAAC8G,EAAD,OACSnB,SAASoB,eAAe","file":"static/js/main.3b2b3fbc.chunk.js","sourcesContent":["import { handleActions } from \"redux-actions\";\n\nconst reducers = handleActions(\n    {\n        \"LINES_DISCOVERY/SUCCESS\": (state, action) => {\n            return Object.assign({}, state, { linesDiscovery: action.payload })\n        },\n        \"LINES_DISCOVERY/FAILURE\": (state, action) => {\n            return Object.assign({}, state, { linesDiscovery: {} })\n        },\n        \"STOP_POINTS_DISCOVERY/SUCCESS\": (state, action) => {\n            return Object.assign({}, state, { stopPointsDiscovery: action.payload })\n        },\n        \"STOP_POINTS_DISCOVERY/FAILURE\": (state, action) => {\n            return Object.assign({}, state, { stopPointsDiscovery: {} })\n        },\n        \"STOP_MONITORING/SUCCESS\": (state, action) => {\n            let result = Object.assign({}, state);\n            result.stopMonitoring[action.meta.name] = action.payload;\n            return result;\n        },\n        \"STOP_MONITORING/FAILURE\": (state, action) => {\n            let result = Object.assign({}, state);\n            delete result.stopMonitoring[action.meta.name];\n            return result;\n        },\n        \"ESTIMATED_TIMETABLE/SUCCESS\": (state, action) => {\n            let result = Object.assign({}, state);\n            result.estimatedTimetable[action.meta.name] = action.payload;\n            return result;\n        },\n        \"ESTIMATED_TIMETABLE/FAILURE\": (state, action) => {\n            let result = Object.assign({}, state);\n            delete result.estimatedTimetable[action.meta.name];\n            return result;\n        }\n    },\n    {\n        linesDiscovery: {},\n        stopPointsDiscovery: {},\n        stopMonitoring: {},\n        estimatedTimetable: {}\n    }\n);\n\nexport default reducers;","import { createStore, applyMiddleware } from 'redux'\nimport thunk from 'redux-thunk'\nimport logger from 'redux-logger'\nimport reducers from './reducers'\n\nconst store = createStore(\n    reducers,\n    applyMiddleware(thunk, logger)\n);\n\nexport default store;\n","import { Observable, from } from 'rxjs';\nimport { mergeMap } from 'rxjs/operators';\nimport * as T from \"../types\";\n\nconst StopPointsDiscoveryService = {\n    get: function (options) {\n        let upperLeftTile = this.toTile(options[T.UPPER_LEFT_LONGITUDE], options[T.UPPER_LEFT_LATITUDE], T.ZOOM);\n        let lowerRightTile = this.toTile(options[T.LOWER_RIGHT_LONGITUDE], options[T.LOWER_RIGHT_LATITUDE], T.ZOOM);\n\n        return this.query(upperLeftTile, lowerRightTile).pipe(mergeMap(url => this.request(url)));\n    },\n\n    toTile: function (lon, lat, zoom) {\n        let result = [Math.floor((lon + 180) / 360 * Math.pow(2, zoom)),\n        Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom))];\n        return result;\n    },\n\n    query: function (from, to) {\n        return Observable.create(function (observer) {\n            for (let x = from[0]; x <= from[0]; x++) {\n                for (let y = to[1]; y <= to[1]; y++) {\n                    let url = (process.env.NODE_ENV !== \"production\") ? \"https://localhost:8443\" : \"\"\n                    url += \"/siri-xlite/stoppoints-discovery/\" + x + \"/\" + y;\n                    observer.next(url);\n                }\n            }\n            observer.complete();\n        });\n    },\n\n    request: function (url) {\n        return from(fetch(url, {\n            \"Content-Type\": \"application/json\"\n        }).then(response => response.json()));\n    }\n};\n\nexport default StopPointsDiscoveryService;\n","export const UPPER_LEFT_LONGITUDE = \"BoundingBox.UpperLeft.Longitude\";\nexport const UPPER_LEFT_LATITUDE = \"BoundingBox.UpperLeft.Latitude\";\nexport const LOWER_RIGHT_LONGITUDE = \"BoundingBox.LowerRight.Longitude\";\nexport const LOWER_RIGHT_LATITUDE = \"BoundingBox.LowerRight.Latitude\";\n\nexport const MONITORING_REF = \"MonitoringRef\";\nexport const MAXIMUM_STOP_VISITS = \"MaximumStopVisits\";\nexport const MAXIMUM_NUMBER_CALLS_OF_ONWARDS = \"MaximumNumberOfCalls.Onwards\";\nexport const MAXIMUM_NUMBER_CALLS_OF_PREVIOUS = \"MaximumNumberOfCalls.Previous\";\n\nexport const ZOOM = 15;\n","const StopMonitoringService = {\n    get: function (options) {\n        let url = (process.env.NODE_ENV !== \"production\") ? \"http://127.0.0.1:8080\" : \"\"\n        url += \"/siri-lite/stop-monitoring\"\n        url += options && \"?\" + Object.entries(options).map(([key, value]) => `${key}=${value}`).join('&');\n        return fetch(url, {\n            \"Content-Type\": \"application/json\"\n        }).then(response => response.json());\n    }\n};\n\nexport default StopMonitoringService;","import { createActions } from 'redux-actions';\nimport linesDiscoveryService from \"./services/LinesDiscoveryService\";\nimport stopPointsDiscoveryService from \"./services/StopPointsDiscoveryService\";\nimport stopMonitoringService from \"./services/StopMonitoringService\";\nimport estimatedTimetableService from \"./services/EstimatedTimetableService\";\n\nexport const loadLinesDiscovery = (payload) => dispatch => {\n    return linesDiscoveryService.get(payload).then(\n        value => dispatch(actions.linesDiscovery.success(value)),\n        error => dispatch(actions.linesDiscovery.failure(error))\n    );\n};\n\nexport const loadStopPointsDiscovery = (payload) => dispatch => {\n    return stopPointsDiscoveryService.get(payload).subscribe(\n        value => dispatch(actions.stopPointsDiscovery.success(value)),\n        error => dispatch(actions.stopPointsDiscovery.failure(error))\n    );\n};\n\nexport const loadStopMonitoring = (payload, name) => dispatch => {\n    return stopMonitoringService.get(payload).then(\n        value => dispatch(actions.stopMonitoring.success(value, name)),\n        error => dispatch(actions.stopMonitoring.failure(error, name))\n    );\n};\n\nexport const loadEstimatedTimetable = (payload, name) => dispatch => {\n    return estimatedTimetableService.get(payload).then(\n        value => dispatch(actions.estimatedTimetable.success(value, name)),\n        error => dispatch(actions.estimatedTimetable.failure(error, name))\n    );\n};\n\nconst actions = createActions(\n    {\n        LINES_DISCOVERY: {\n            SUCCESS: payload => payload,\n            FAILURE: payload => payload\n        },\n        STOP_POINTS_DISCOVERY: {\n            SUCCESS: payload => payload,\n            FAILURE: payload => payload\n        },\n        STOP_MONITORING: {\n            SUCCESS: [\n                payload => payload,\n                (payload, name) => ({ name })\n            ],\n            FAILURE: [\n                payload => payload,\n                (payload, name) => ({ name })\n            ],\n        },\n        ESTIMATED_TIMETABLE: {\n            SUCCESS: [\n                payload => payload,\n                (payload, name) => ({ name })\n            ],\n            FAILURE: [\n                payload => payload,\n                (payload, name) => ({ name })\n            ],\n        }\n    }\n);\n\nexport default actions;\n","import React from \"react\";\nimport { connect } from 'react-redux'\nimport PropTypes from \"prop-types\";\nimport { createSelector } from 'reselect'\nimport Moment from 'react-moment';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\n\nimport actions, { loadStopMonitoring } from \"../../actions\";\nimport * as T from \"../../types\";\nimport \"./StopMonitoringComponent.scss\"\n\nclass StopMonitoringComponent extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.counter = 1;\n    }\n\n    componentDidMount() {\n        this.initialize();\n    }\n\n    componentWillUnmount() {\n        this.dispose();\n    }\n\n    initialize() {\n        const options = {\n            [T.MONITORING_REF]: this.props.name,\n            [T.MAXIMUM_STOP_VISITS]: this.props.length,\n            [T.MAXIMUM_NUMBER_CALLS_OF_PREVIOUS]: 0,\n            [T.MAXIMUM_NUMBER_CALLS_OF_ONWARDS]: 0,\n        };\n        this.props.onChange(options);\n        this.timer = setInterval((e) => this.counter++ && this.props.onChange(options), 10000);\n    }\n\n    dispose() {\n        clearInterval(this.timer);\n        this.props.onClose();\n    }\n\n    render() {\n\n        const Row = (props) => {\n            return (<tr >\n                <th scope=\"row\"><Moment format=\"HH:mm\">{props.value.MonitoredCall.ExpectedDepartureTime}</Moment></th>\n                <td style={{ textTransform: 'uppercase' }}>{props.value.DestinationName}</td>\n                <td style={{ textTransform: 'uppercase' }}>{props.value.PublishedLineName}</td>\n                <td>\n                    <FontAwesomeIcon style={{ color: \"steelblue\" }} icon=\"bus\" />\n                </td>\n            </tr>)\n        }\n\n        const Rows = (props) => {\n            return (props.values) ? props.values.map((value) => <Row value={value.MonitoredVehicleJourney} key={value.ItemIdentifier} />) : (null);\n        }\n\n        return (<div>\n            <h5>#{this.counter} StopMonitoring: {this.props.name}</h5>\n            <table className=\"table table-sm table-hover\">\n                <thead>\n                    <tr>\n                        <th>Departure</th>\n                        <th>Destination</th>\n                        <th>Line</th>\n                        <th>#</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <Rows values={this.props.values} />\n                </tbody>\n            </table>\n        </div >);\n    }\n}\n\nStopMonitoringComponent.propTypes = {\n    name: PropTypes.string.isRequired,\n    length: PropTypes.number.isRequired,\n    values: PropTypes.array.isRequired,\n    onChange: PropTypes.func.isRequired,\n    onClose: PropTypes.func.isRequired\n};\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        onClose: () => dispatch(actions.stopMonitoring.failure({})),\n        onChange: (options) => {\n            dispatch(loadStopMonitoring(options, options[T.MONITORING_REF]));\n        }\n    }\n}\n\nconst selector = createSelector((state, props) => state.stopMonitoring[props.name],\n    value => value ? value.Siri.StopMonitoringDelivery.MonitoredStopVisit : []);\n\nconst mapStateToProps = (state, props) => {\n    return {\n        name: props.name,\n        length: props.length,\n        values: selector(state, props)\n    };\n}\n\nexport default connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(StopMonitoringComponent);","import React from \"react\";\nimport ReactDOM from 'react-dom';\nimport PropTypes from \"prop-types\";\nimport { Provider, connect } from \"react-redux\";\nimport { createSelector } from 'reselect'\nimport * as L from \"leaflet\";\n\nimport store from \"../../store\"\nimport \"./StopPointsDiscoveryComponent.scss\";\nimport actions, { loadStopPointsDiscovery } from \"../../actions\";\nimport * as T from \"../../types\";\nimport StopMonitoringComponent from \"../stop-monitoring/StopMonitoringComponent\";\n\nclass StopPointsDiscoveryComponent extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.ref = React.createRef();\n    }\n\n    componentDidMount() {\n        this.initialize();\n    }\n\n    componentWillUnmount() {\n        this.dispose();\n    }\n\n    componentDidUpdate() {\n        this.update(this.props.value.Siri);\n    }\n\n    initialize() {\n        this.stopPointIcon = L.icon({\n            iconUrl: \"images/marker-icon.png\",\n            shadowUrl: \"images/marker-shadow.png\"\n        });\n\n        this.stopAreaIcon = L.icon({\n            iconUrl: \"images/marker-red-icon.png\",\n            shadowUrl: \"images/marker-shadow.png\"\n        });\n\n        this.map = new L.map(this.ref.current, {\n            center: L.latLng(this.props.center),\n            zoom: this.props.zoom\n        });\n        L.tileLayer(this.props.url, {}).addTo(this.map);\n        this.markers = L.layerGroup([]).addTo(this.map);\n        this.popups = L.layerGroup([]).addTo(this.map);\n        L.control.scale().addTo(this.map);\n\n        this.map.on(\"moveend\", this.load, this);\n        this.load();\n    }\n\n    dispose() {\n        this.props.onClose();\n    }\n\n    load() {\n        if (this.map.getZoom() >= this.props.zoom) {\n            let bounds = this.map.getBounds();\n            let count = this.markers.getLayers().length;\n            if (!this.bounds || !this.bounds.contains(bounds) || count === 0) {\n                let dx = this.diff(bounds.getEast(), bounds.getWest());\n                let dy = this.diff(bounds.getNorth(), bounds.getSouth());\n                this.bounds = new L.LatLngBounds(\n                    new L.LatLng(bounds.getSouth() - dy, bounds.getWest() - dx),\n                    new L.LatLng(bounds.getNorth() + dy, bounds.getEast() + dx)\n                );\n                const options = {\n                    [T.UPPER_LEFT_LONGITUDE]: bounds.getNorthWest().lng,\n                    [T.UPPER_LEFT_LATITUDE]: bounds.getNorthWest().lat,\n                    [T.LOWER_RIGHT_LONGITUDE]: bounds.getSouthEast().lng,\n                    [T.LOWER_RIGHT_LATITUDE]: bounds.getSouthEast().lat,\n                };\n                this.props.onChange(options);\n            }\n        }\n    }\n\n    diff(a, b) {\n        let result = a * b > 0 ? Math.abs(b - a) : Math.abs(a) + Math.abs(b);\n        return result;\n    }\n\n    update(value) {\n        this.markers.clearLayers();\n        this.popups.clearLayers();\n        if (value) {\n            let array = value.StopPointsDelivery.AnnotatedStopPointRef;\n\n            array.forEach(i => {\n                let latlng = L.latLng(i.Location.Latitude, i.Location.Longitude);\n                let options = {\n                    title: i.StopName[\"0\"].value + \"\\n\" + i.StopPointRef,\n                    alt: i.StopPointRef,\n                    icon: i.StopPointRef.startsWith(\"StopArea\")\n                        ? this.stopAreaIcon\n                        : this.stopPointIcon\n                };\n                let marker = L.marker(latlng, options);\n                marker.on(\"click\", () => {\n                    this.createPopup(marker);\n                });\n                this.markers.addLayer(marker);\n            });\n        }\n    }\n\n    createPopup(marker) {\n        let popup = marker.getPopup();\n        if (popup) {\n            popup.closePopup();\n        } else {\n            let popup = L.popup({\n                autoClose: false,\n                closeOnClick: false,\n                closeButton: false\n            });\n            popup.setLatLng(marker.getLatLng());\n\n            let div = document.createElement('div');\n            popup.setContent(div);\n            const element = <Provider store={store}><StopMonitoringComponent name={marker.options.alt} length={10} /></Provider>;\n            ReactDOM.render(element, div);\n\n            marker.bindPopup(popup);\n            marker.on(\"popupclose\", () => {\n                ReactDOM.unmountComponentAtNode(div);\n                marker.unbindPopup();\n            });\n            this.popups.addLayer(popup);\n        }\n    }\n\n    render() {\n        return (<div id=\"map\" ref={this.ref} />);\n    }\n}\n\nStopPointsDiscoveryComponent.propTypes = {\n    url: PropTypes.string.isRequired,\n    center: PropTypes.array.isRequired,\n    zoom: PropTypes.number.isRequired,\n    value: PropTypes.object.isRequired,\n    onChange: PropTypes.func.isRequired,\n    onClose: PropTypes.func.isRequired\n};\n\nStopPointsDiscoveryComponent.defaultProps = {\n    url: \"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n    zoom: 17\n};\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        onClose: () => dispatch(actions.stopPointsDiscovery.failure({})),\n        onChange: (options) => {\n            dispatch(loadStopPointsDiscovery(options));\n        }\n    }\n}\n\nconst selector = createSelector((state, props) => state.stopPointsDiscovery, value => value);\n\nconst mapStateToProps = (state, props) => {\n    return {\n        url: props.url,\n        center: props.center,\n        zoom: props.zoom,\n        value: selector(state, props)\n    };\n}\n\nexport default connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(StopPointsDiscoveryComponent);","import React from \"react\";\nimport StopPointsDiscoveryComponent from \"./components/stop-points-discovery/StopPointsDiscoveryComponent\";\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { faBus } from '@fortawesome/free-solid-svg-icons'\nimport \"./App.scss\";\n\nlibrary.add(faBus)\n\nclass App extends React.Component {\n\n  render() {\n    return (\n      <div className=\"App\">\n        <StopPointsDiscoveryComponent center={[48.866667, 2.333333]} />\n      </div>\n    );\n  }\n}\n\nexport default App;","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\"\n\nimport \"./index.scss\";\nimport App from \"./App\";\nimport store from \"./store\"\n\nReactDOM.render(\n    <Provider store={store}>\n        <App />\n    </Provider>, document.getElementById('root'));"],"sourceRoot":""}